drop table if exists t1;
create function if not exists non_default_engine()
returns varchar(255)
deterministic
begin
if default_engine() = 'InnoDB' then
return 'MyISAM';
end if;
return 'InnoDB';
end~~
create table t1 (
x1 int unsigned,
Sys_start SYS_DATATYPE generated always as row start comment 'start',
Sys_end SYS_DATATYPE generated always as row end comment 'end',
period for system_time (Sys_start, Sys_end)
) with system versioning;
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `x1` int(10) unsigned DEFAULT NULL,
  `Sys_start` SYS_DATATYPE GENERATED ALWAYS AS ROW START COMMENT 'start',
  `Sys_end` SYS_DATATYPE GENERATED ALWAYS AS ROW END COMMENT 'end',
  PERIOD FOR SYSTEM_TIME (`Sys_start`, `Sys_end`)
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1 WITH SYSTEM VERSIONING
# Implicit fields test
create or replace table t1 (
x2 int unsigned
) with system versioning;
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `x2` int(10) unsigned DEFAULT NULL,
  `sys_trx_start` SYS_DATATYPE GENERATED ALWAYS AS ROW START,
  `sys_trx_end` SYS_DATATYPE GENERATED ALWAYS AS ROW END,
  PERIOD FOR SYSTEM_TIME (`sys_trx_start`, `sys_trx_end`)
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1 WITH SYSTEM VERSIONING
create or replace table t1 (
x3 int unsigned,
Sys_start SYS_DATATYPE generated always as row start,
Sys_end SYS_DATATYPE generated always as row end,
period for system_time (x, Sys_end)
) with system versioning;
ERROR HY000: PERIOD FOR SYSTEM_TIME must use columns `Sys_start` and `Sys_end`
create or replace table t1 (
x4 int unsigned,
Sys_start SYS_DATATYPE generated always as row start,
Sys_end2 SYS_DATATYPE generated always as row end,
period for system_time (Sys_start, Sys_end)
) with system versioning;
ERROR HY000: PERIOD FOR SYSTEM_TIME must use columns `Sys_start` and `Sys_end2`
create or replace table t1 (
x5 int unsigned,
Sys_start SYS_DATATYPE generated always as row start,
Sys_end SYS_DATATYPE generated always as row end,
period for system_time (Sys_start, x)
) with system versioning;
ERROR HY000: PERIOD FOR SYSTEM_TIME must use columns `Sys_start` and `Sys_end`
create or replace table t1 (
x6 int unsigned,
period for system_time (Sys_start, Sys_end)
) with system versioning;
ERROR HY000: Wrong parameters for `t1`: missing 'AS ROW START'
create or replace table t1 (
x7 int unsigned,
Sys_start SYS_DATATYPE generated always as row start,
Sys_end SYS_DATATYPE generated always as row end,
period for system_time (Sys_start, Sys_end)
);
ERROR HY000: Wrong parameters for `t1`: missing 'WITH SYSTEM VERSIONING'
create or replace table t1 (
x8 int unsigned,
Sys_start SYS_DATATYPE generated always as row start,
Sys_end SYS_DATATYPE generated always as row end,
period for system_time (sys_insert, sys_remove)
) with system versioning;
ERROR HY000: PERIOD FOR SYSTEM_TIME must use columns `Sys_start` and `Sys_end`
create or replace table t1 (
x9 int unsigned,
Sys_start SYS_DATATYPE generated always as row start,
Sys_end SYS_DATATYPE generated always as row end,
period for system_time (Sys_start, Sys_end)
);
ERROR HY000: Wrong parameters for `t1`: missing 'WITH SYSTEM VERSIONING'
create or replace table t1 (
x10 int unsigned,
Sys_start SYS_DATATYPE generated always as row start,
Sys_end SYS_DATATYPE generated always as row end,
period for system_time (Sys_start, Sys_start)
);
ERROR HY000: Wrong parameters for `t1`: missing 'WITH SYSTEM VERSIONING'
create or replace table t1 (
x11 int unsigned,
Sys_start bigint unsigned generated always as row start,
Sys_end timestamp(6) generated always as row end,
period for system_time (Sys_start, Sys_end)
) with system versioning;
Got one of the listed errors
create or replace table t1 (
x12 int unsigned,
Sys_start timestamp(6) generated always as row start,
Sys_end bigint unsigned generated always as row end,
period for system_time (Sys_start, Sys_end)
) with system versioning;
Got one of the listed errors
create or replace table t1 (
x13 int unsigned,
Sys_start bigint generated always as row start,
Sys_end bigint unsigned generated always as row end,
period for system_time (Sys_start, Sys_end)
) with system versioning engine innodb;
ERROR HY000: `Sys_start` must be of type BIGINT(20) UNSIGNED for versioned table `t1`
create or replace table t1 (
x14 int unsigned,
Sys_start bigint unsigned generated always as row start,
Sys_end bigint generated always as row end,
period for system_time (Sys_start, Sys_end)
) with system versioning engine innodb;
ERROR HY000: `Sys_end` must be of type BIGINT(20) UNSIGNED for versioned table `t1`
create or replace table t1 (
A1 int with system versioning,
B int
);
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `A1` int(11) DEFAULT NULL,
  `B` int(11) DEFAULT NULL WITHOUT SYSTEM VERSIONING,
  `sys_trx_start` SYS_DATATYPE GENERATED ALWAYS AS ROW START,
  `sys_trx_end` SYS_DATATYPE GENERATED ALWAYS AS ROW END,
  PERIOD FOR SYSTEM_TIME (`sys_trx_start`, `sys_trx_end`)
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1 WITH SYSTEM VERSIONING
create or replace table t1 (
A2 int with system versioning,
B int
) with system versioning;
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `A2` int(11) DEFAULT NULL,
  `B` int(11) DEFAULT NULL,
  `sys_trx_start` SYS_DATATYPE GENERATED ALWAYS AS ROW START,
  `sys_trx_end` SYS_DATATYPE GENERATED ALWAYS AS ROW END,
  PERIOD FOR SYSTEM_TIME (`sys_trx_start`, `sys_trx_end`)
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1 WITH SYSTEM VERSIONING
create or replace table t1 (
A3 int,
B int without system versioning
);
create or replace table t1 (
A4 int,
B int without system versioning
) with system versioning;
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `A4` int(11) DEFAULT NULL,
  `B` int(11) DEFAULT NULL WITHOUT SYSTEM VERSIONING,
  `sys_trx_start` SYS_DATATYPE GENERATED ALWAYS AS ROW START,
  `sys_trx_end` SYS_DATATYPE GENERATED ALWAYS AS ROW END,
  PERIOD FOR SYSTEM_TIME (`sys_trx_start`, `sys_trx_end`)
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1 WITH SYSTEM VERSIONING
create or replace table t1 (
A5 int with system versioning,
B int without system versioning
);
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `A5` int(11) DEFAULT NULL,
  `B` int(11) DEFAULT NULL WITHOUT SYSTEM VERSIONING,
  `sys_trx_start` SYS_DATATYPE GENERATED ALWAYS AS ROW START,
  `sys_trx_end` SYS_DATATYPE GENERATED ALWAYS AS ROW END,
  PERIOD FOR SYSTEM_TIME (`sys_trx_start`, `sys_trx_end`)
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1 WITH SYSTEM VERSIONING
create or replace table t1 (
A6 int with system versioning,
B int without system versioning
) with system versioning;
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `A6` int(11) DEFAULT NULL,
  `B` int(11) DEFAULT NULL WITHOUT SYSTEM VERSIONING,
  `sys_trx_start` SYS_DATATYPE GENERATED ALWAYS AS ROW START,
  `sys_trx_end` SYS_DATATYPE GENERATED ALWAYS AS ROW END,
  PERIOD FOR SYSTEM_TIME (`sys_trx_start`, `sys_trx_end`)
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1 WITH SYSTEM VERSIONING
create or replace table t1 (
A7 int without system versioning
);
create or replace table t1 (
A8 int without system versioning
) with system versioning;
ERROR HY000: Table `t1` has no versioned columns
create or replace table t1 (a int) with system versioning;
create table tt1 like t1;
show create table tt1;
Table	Create Table
tt1	CREATE TABLE `tt1` (
  `a` int(11) DEFAULT NULL,
  `sys_trx_start` SYS_DATATYPE GENERATED ALWAYS AS ROW START,
  `sys_trx_end` SYS_DATATYPE GENERATED ALWAYS AS ROW END,
  PERIOD FOR SYSTEM_TIME (`sys_trx_start`, `sys_trx_end`)
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1 WITH SYSTEM VERSIONING
drop table tt1;
create temporary table tt1 like t1;
Warnings:
Warning	1105	System versioning is stripped from temporary `test.tt1`
# Temporary is stripped from versioning
show create table tt1;
Table	Create Table
tt1	CREATE TEMPORARY TABLE `tt1` (
  `a` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
create or replace table t1 (x int) with system versioning;
create or replace table t0(
y int,
st SYS_DATATYPE generated always as row start,
en SYS_DATATYPE generated always as row end,
period for system_time (st, en)
) with system versioning;
create or replace table t2 as select * from t1;
show create table t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `x` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
create or replace table t3 as select * from t0;
show create table t3;
Table	Create Table
t3	CREATE TABLE `t3` (
  `y` int(11) DEFAULT NULL
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1
insert into t1 values (1);
insert into t0 values (2);
create or replace table t2 with system versioning as select * from t1;
show create table t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `x` int(11) DEFAULT NULL,
  `sys_trx_start` SYS_DATATYPE GENERATED ALWAYS AS ROW START,
  `sys_trx_end` SYS_DATATYPE GENERATED ALWAYS AS ROW END,
  PERIOD FOR SYSTEM_TIME (`sys_trx_start`, `sys_trx_end`)
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1 WITH SYSTEM VERSIONING
select * from t2;
x
1
create or replace table t3 with system versioning as select * from t0;
show create table t3;
Table	Create Table
t3	CREATE TABLE `t3` (
  `y` int(11) DEFAULT NULL,
  `st` SYS_DATATYPE DEFAULT NULL,
  `en` SYS_DATATYPE DEFAULT NULL,
  `sys_trx_start` SYS_DATATYPE GENERATED ALWAYS AS ROW START,
  `sys_trx_end` SYS_DATATYPE GENERATED ALWAYS AS ROW END,
  PERIOD FOR SYSTEM_TIME (`sys_trx_start`, `sys_trx_end`)
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1 WITH SYSTEM VERSIONING
select * from t3 where y > 2;
y	st	en
delete from t0;
create or replace table t1 (x int) with system versioning;
create or replace table t2 (y int);
create or replace table t3 with system versioning select * from t1 for system_time all, t2;
show create table t3;
Table	Create Table
t3	CREATE TABLE `t3` (
  `x` int(11) DEFAULT NULL,
  `y` int(11) DEFAULT NULL,
  `sys_trx_start` SYS_DATATYPE GENERATED ALWAYS AS ROW START,
  `sys_trx_end` SYS_DATATYPE GENERATED ALWAYS AS ROW END,
  PERIOD FOR SYSTEM_TIME (`sys_trx_start`, `sys_trx_end`)
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1 WITH SYSTEM VERSIONING
### versioned implicit from versioned explicit
create or replace table t2 with system versioning
as select * from t0;
show create table t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `y` int(11) DEFAULT NULL,
  `st` SYS_DATATYPE DEFAULT NULL,
  `en` SYS_DATATYPE DEFAULT NULL,
  `sys_trx_start` SYS_DATATYPE GENERATED ALWAYS AS ROW START,
  `sys_trx_end` SYS_DATATYPE GENERATED ALWAYS AS ROW END,
  PERIOD FOR SYSTEM_TIME (`sys_trx_start`, `sys_trx_end`)
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1 WITH SYSTEM VERSIONING
### proper way to create from versioned explicit
create or replace table t2(
st bigint(20) unsigned generated always as row start,
en bigint(20) unsigned generated always as row end,
period for system_time (st, en)
) with system versioning
as select * from t0;
show create table t2;
Table	Create Table
t2	CREATE TABLE `t2` (
  `y` int(11) DEFAULT NULL,
  `st` SYS_DATATYPE GENERATED ALWAYS AS ROW START,
  `en` SYS_DATATYPE GENERATED ALWAYS AS ROW END,
  PERIOD FOR SYSTEM_TIME (`st`, `en`)
) ENGINE=DEFAULT_ENGINE DEFAULT CHARSET=latin1 WITH SYSTEM VERSIONING
